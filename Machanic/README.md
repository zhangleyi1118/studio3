# BTS7960接线方案
PWM分组（3组，每组共用一对RPWM/LPWM）：
组1（杆1-2）：RPWM=D2, LPWM=D3
组2（杆3-6）：RPWM=D4, LPWM=D5
组3（杆7-14）：RPWM=D6, LPWM=D7
详细接线表：
杆#	R_EN	L_EN	RPWM	LPWM
1	D22	D23	D2	D3
2	D24	D25	D2	D3
3	D26	D27	D4	D5
4	D28	D29	D4	D5
5	D30	D31	D4	D5
6	D32	D33	D4	D5
7	D34	D35	D6	D7
8	D36	D37	D6	D7
9	D38	D39	D6	D7
10	D40	D41	D6	D7
11	D42	D43	D6	D7
12	D46	D47	D6	D7
13	D48	D49	D6	D7
14	D50	D51	D6	D7

# 多组件同步控制系统 - 接线指南

## 系统概述

本系统控制以下硬件组件：
- **14根电动伸缩杆**（分2组控制）
- **步进电机滑台** (TB6600驱动)
- **舵机MG996R**

---

## 一、硬件清单

### 主控板
- Arduino Mega 2560 × 1

### 执行器
- 电动伸缩杆 × 14（带BTS7960驱动板）
- 步进电机 + TB6600驱动器 × 1
- MG996R舵机 × 1

### 电源
- 12V电源（供伸缩杆）
- 24V电源（供步进电机）
- 5V电源（供舵机，可用Arduino 5V）

---

## 二、接线方案

### 1️⃣ 电动伸缩杆（14根，分2组）

#### 📌 组1：伸缩杆 1-6

每根杆使用1个BTS7960驱动板，接线如下：

| 杆编号 | RPWM | LPWM | R_EN | L_EN | 备注 |
|--------|------|------|------|------|------|
| 杆1 | D2（共用） | D3（共用） | D22 | D23 | 6根杆共用PWM |
| 杆2 | D2（共用） | D3（共用） | D24 | D25 | 独立使能控制 |
| 杆3 | D2（共用） | D3（共用） | D26 | D27 | |
| 杆4 | D2（共用） | D3（共用） | D28 | D29 | |
| 杆5 | D2（共用） | D3（共用） | D30 | D31 | |
| 杆6 | D2（共用） | D3（共用） | D32 | D33 | |

**BTS7960接线模板（以杆1为例）：**
BTS7960驱动板 Arduino Mega

RPWM → D2
LPWM → D3
R_EN → D22
L_EN → D23
VCC → 5V
GND → GND
+12V / GND → 12V电源正负极
M+ / M- → 伸缩杆电机正负极


**⚠️ 重要：**
- 组1的6根杆的 RPWM 全部接 **D2**
- 组1的6根杆的 LPWM 全部接 **D3**
- 每根杆的 R_EN 和 L_EN 独立连接（见上表）
- 所有驱动板的 GND 必须与 Arduino GND 共地

---

#### 📌 组2：伸缩杆 7-14

| 杆编号 | RPWM | LPWM | R_EN | L_EN |
|--------|------|------|------|------|
| 杆7  | D4（共用） | D5（共用） | D34 | D35 |
| 杆8  | D4（共用） | D5（共用） | D36 | D37 |
| 杆9  | D4（共用） | D5（共用） | D38 | D39 |
| 杆10 | D4（共用） | D5（共用） | D40 | D41 |
| 杆11 | D4（共用） | D5（共用） | D42 | D43 |
| 杆12 | D4（共用） | D5（共用） | D44 | D45 |
| 杆13 | D4（共用） | D5（共用） | D46 | D47 |
| 杆14 | D4（共用） | D5（共用） | D48 | D49 |

**接线方式同组1，只是PWM引脚改为D4/D5**

---

### 2️⃣ 步进电机滑台（TB6600驱动）

#### 引脚定义
- **STEP** = A0（代码中的D54）
- **DIR** = A1（代码中的D55）
- **ENA** = A2（代码中的D56）

#### 完整接线表

| TB6600端子 | 连接目标 | 说明 |
|-----------|---------|------|
| **PUL+** | Arduino 5V | 脉冲信号参考电压 |
| **PUL-** | Arduino A0 | 脉冲控制引脚 |
| **DIR+** | Arduino 5V | 方向信号参考电压 |
| **DIR-** | Arduino A1 | 方向控制引脚 |
| **ENA+** | Arduino 5V | 使能信号参考电压 |
| **ENA-** | Arduino A2 | 使能控制引脚 |
| **+V** | 24V电源正极 | 电机供电 |
| **GND** | 24V电源负极 + Arduino GND | **必须共地** |
| **A+, A-** | 步进电机A相 | 电机线圈 |
| **B+, B-** | 步进电机B相 | 电机线圈 |

#### 工作原理
- TB6600内部使用光耦隔离
- 当Arduino引脚输出 **LOW（0V）** 时，5V→0V产生压差，光耦导通，信号激活
- 当Arduino引脚输出 **HIGH（5V）** 时，5V→5V无压差，光耦关断

#### TB6600拨码开关设置（推荐）
细分设置：1600步/转（SW5=ON, SW6=ON, SW7=ON, SW8=ON）
电流设置：根据电机额定电流调整（通常2-3A）

---

### 3️⃣ 舵机（MG996R）

| 舵机线 | Arduino Mega | 说明 |
|--------|--------------|------|
| 红线（+） | 5V或外部5V | 供电（建议外部5V） |
| 棕线（-） | GND | 与Arduino共地 |
| 橙线（信号） | D9 | PWM控制信号 |

**⚠️ 注意：**
- MG996R堵转电流可达2A，Arduino板载5V输出能力有限
- 建议使用独立5V电源供电，GND与Arduino共地
- 信号线必须接D9引脚（支持PWM）

---

## 三、接线检查清单

### ✅ 上电前必查
- [ ] 所有驱动板GND已与Arduino GND连接
- [ ] 24V电源GND已与Arduino GND连接
- [ ] 12V电源GND已与Arduino GND连接
- [ ] PWM引脚无短路（组1的D2/D3，组2的D4/D5）
- [ ] TB6600的 "+端" 全部接5V，"-端" 全部接Arduino引脚
- [ ] 舵机供电独立，仅信号线接D9

### ✅ 电源要求
- 12V电源容量：至少能提供 14根杆 × 电机额定电流
- 24V电源容量：步进电机额定电流 + 余量
- 5V电源容量：舵机峰值2A

---

## 四、引脚速查表

### Arduino Mega 2560 引脚占用

| 功能 | 引脚 | 数量 |
|------|------|------|
| 伸缩杆组1 PWM | D2, D3 | 2 |
| 伸缩杆组2 PWM | D4, D5 | 2 |
| 伸缩杆组1 使能 | D22-D33（偶数R_EN，奇数L_EN） | 12 |
| 伸缩杆组2 使能 | D34-D49（偶数R_EN，奇数L_EN） | 16 |
| 步进电机控制 | A0, A1, A2 | 3 |
| 舵机控制 | D9 | 1 |
| **总计** | | **36个引脚** |

### 模拟引脚映射
A0 = D54 (STEP)
A1 = D55 (DIR)
A2 = D56 (ENA)


---

## 五、调试步骤

### 1. 单独测试伸缩杆
发送命令：GROUP1,F,20
预期结果：组1的6根杆同时前进3秒（20% × 15秒）

### 2. 单独测试步进电机
发送命令：STEPPER,R,10
预期结果：步进电机向右运动1.5秒

### 3. 单独测试舵机
发送命令：SERVO,180,50
预期结果：舵机转向90度位置（50% × 180度）

### 4. 测试主模式
发送命令：f,20
预期结果：所有组件同步运动（前进、右移、逆时针）

### 5. 紧急停止
发送命令：s
预期结果：所有运动立即停止


---

## 六、常见问题

### ❓ 伸缩杆不动
- 检查对应EN引脚是否连接正确
- 检查PWM引脚（D2/D3或D4/D5）是否共享正确
- 检查12V电源是否正常
- 检查BTS7960的GND是否与Arduino共地

### ❓ 步进电机抖动不转
- 检查TB6600拨码开关细分设置
- 检查电机线圈接线顺序（A+A-，B+B-）
- 检查24V电源电压是否足够
- 尝试交换A+A-或B+B-其中一组，修正转向

### ❓ 舵机抽搐或无力
- 使用独立5V电源供电
- 检查信号线是否接到D9引脚
- 检查GND是否共地

### ❓ 串口无响应
- 确认波特率设置为 **115200**
- 检查USB线连接
- 重新上传代码

---

## 七、安全注意事项

⚠️ **警告**
1. 上电顺序：先连接所有信号线 → 再连接电源
2. 断电顺序：先断Arduino → 再断外部电源
3. 调试时限制运动百分比（建议<50%）
4. 伸缩杆运动时注意机械限位
5. 首次运行前执行初始化命令：`START,ALL`

---

## 八、命令参考

详见代码注释，主要命令：
- 主模式：`f,20` / `b,20`
- 调试模式：`GROUP1,F,20` / `STEPPER,L,30` / `SERVO,180,50`
- 初始化：`START,ALL` / `START,ACTUATORS` / `START,STEPPER`
- 停止：`s`

---

**作者**：多组件同步控制系统  
**版本**：v1.0  
**最后更新**：2026-01-06